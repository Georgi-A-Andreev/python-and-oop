CREATE TABLE countries (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL
);


CREATE TABLE customers (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(25) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    gender CHAR(1) CHECK (gender IN ('F', 'M')),
    age INTEGER CHECK (age > 0) NOT NULL,
    phone_number VARCHAR(10) NOT NULL,
    country_id INTEGER REFERENCES countries(id) ON DELETE CASCADE NOT NULL
        CHECK (country_id > 0)
);

CREATE TABLE products(
	id SERIAL PRIMARY KEY,
	name VARCHAR(25) NOT NULL,
	description VARCHAR(250),
	recipe TEXT,
	price NUMERIC(10,2) NOT NULL,
	CONSTRAINT ck_price_positive
	CHECK (price > 0)
);


CREATE TABLE feedbacks(
	id SERIAL PRIMARY KEY,
	description VARCHAR(255),
	rate NUMERIC(4,2),
	product_id INT NOT NULL,
	customer_id INT NOT NULL,
	CONSTRAINT ck_rate
	CHECK (rate BETWEEN 0 AND 10),
	CONSTRAINT fk_feedbacks_products
	FOREIGN KEY (product_id)
	REFERENCES products(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE,
	CONSTRAINT fk_feedbacks_customers
	FOREIGN KEY (customer_id)
	REFERENCES customers(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE
);

CREATE TABLE distributors(
	id SERIAL PRIMARY KEY,
	name VARCHAR(25) NOT NULL,
	address VARCHAR(30) NOT NULL,
	summary VARCHAR(200) NOT NULL,
	country_id INT NOT NULL,
	CONSTRAINT fk_distributors_countries
	FOREIGN KEY (country_id)
	REFERENCES countries(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE,
	CONSTRAINT unique_name
	UNIQUE (name)
);

CREATE TABLE ingredients(
	id SERIAL PRIMARY KEY,
	name VARCHAR(30) NOT NULL,
	description VARCHAR(200),
	country_id INT NOT NULL,
	distributor_id INT NOT NULL,
	CONSTRAINT fk_ingredients_countries
	FOREIGN KEY (country_id)
	REFERENCES countries(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE,
	CONSTRAINT fk_ingredients_distributors
	FOREIGN KEY (distributor_id)
	REFERENCES distributors(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE
);

CREATE TABLE products_ingredients(
	product_id INT,
	ingredient_id INT,
	CONSTRAINT fk_products_ingredients_products
	FOREIGN KEY (product_id)
	REFERENCES products(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE,
	CONSTRAINT fk_products_ingredients_ingredients
	FOREIGN KEY (ingredient_id)
	REFERENCES ingredients(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE
);
-- CREATE TABLE gift_recipients(
-- 	id SERIAL PRIMARY KEY,
-- 	name VARCHAR(255),
-- 	country_id INT,
-- 	gift_sent BOOLEAN DEFAULT False
-- );



CREATE TABLE gift_recipients (
    id SERIAL PRIMARY KEY,
    name TEXT,
    country_id INT,
    gift_sent BOOLEAN DEFAULT False
);

INSERT INTO gift_recipients (name, country_id)
	SELECT
			CONCAT(first_name, ' ', last_name) as name,
			country_id
	FROM customers;

UPDATE gift_recipients
SET gift_sent = TRUE
WHERE country_id IN (7, 8, 14, 17, 26);

select * from gift_recipients
order by id
drop table gift_recipients

CREATE TABLE gift_recipients (
	id INT primary key,
	SELECT
			CONCAT(first_name, ' ', last_name) as name,
			country_id,
			CASE WHEN country_id IN ( 7, 8, 14, 17, 26) THEN True
			ELSE False
			END AS gift_sent
	FROM customers;)


CREATE TABLE gift_recipients (
    id SERIAL PRIMARY KEY,
    name TEXT,
    country_id INTEGER,
    gift_sent BOOLEAN DEFAULT FALSE
);
INSERT INTO gift_recipients (name, country_id, gift_sent)
SELECT
    first_name || ' ' || last_name AS name,
    country_id,
    CASE WHEN country_id IN (7, 8, 14, 17, 26) THEN TRUE ELSE FALSE END AS gift_sent
FROM customers;







